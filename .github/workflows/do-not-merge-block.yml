###
# This workflow fails if a PR has a blocking label (e.g., "do-not-merge").
#
# To customize blocking labels, set the FAIL_LABELS variable (comma-separated).
#     Default: "do-not-merge"
#
# To set the variable, you can use the GitHub CLI:
#     gh variable set FAIL_LABELS --body "do-not-merge,dnm"
###

name: Do Not Merge Blocker

on:
  pull_request:
    types: [opened, labeled, unlabeled]
  merge_group:

permissions: {}

jobs:
  do-not-merge-block:
    name: Do Not Merge Block
    runs-on: ubuntu-latest
    timeout-minutes: 5
    permissions:
      contents: read
    # Skip on merge group events
    if: ${{ github.event_name == 'pull_request' }}
    steps:
      - uses: actions/checkout@v4

      - name: Fail if blocking label present
        uses: actions/github-script@v7
        env:
          FAIL_LABELS: ${{ vars.DO_NOT_MERGE_LABELS || 'do-not-merge' }}
        with:
          script: |
            const script = require('./.github/scripts/do-not-merge-block.js');
            await script({ context, core });
